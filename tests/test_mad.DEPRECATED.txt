# DEPRECATED - test_mad.py

**Status**: DEPRECATED (December 2024)  
**Reason**: Legacy mad.py tests are superseded by test_mad_cli.py

---

## Deprecation Notice

This test file (`test_mad.py`) tests the **LEGACY** `mad.py` argparse-based CLI interface.

While `mad.py` itself remains functional for backward compatibility, the tests are deprecated in favor of comprehensive tests for the modern `mad_cli.py` interface.

### Why Deprecated?

1. **Test Coverage**: `test_mad_cli.py` provides more comprehensive test coverage
2. **Modern Features**: `mad_cli.py` includes new features not present in legacy `mad.py`
3. **GPU Tool Managers**: New tests cover the refactored GPU tool manager architecture
4. **Maintenance**: Maintaining parallel test suites is redundant

### What Remains Functional

- ✅ `mad.py` - Legacy CLI continues to work (backward compatibility)
- ✅ `run_models.py` - Legacy entry point untouched
- ✅ All legacy workflows supported

### Replacement Tests

Comprehensive test coverage is now in:
- **`test_mad_cli.py`** - Modern Typer-based CLI (1100+ lines of tests)
  - Build command tests
  - Run command tests  
  - Discover command tests
  - Error handling tests
  - GPU detection tests
  - Multi-architecture tests
  
- **`test_gpu_tool_managers.py`** - GPU tool manager architecture
  - ROCm version detection
  - Tool selection (amd-smi vs rocm-smi)
  - Fallback mechanisms
  - PR #54 compliance tests

- **`test_orchestration.py`** - Build/Run orchestrators
  - BuildOrchestrator tests
  - RunOrchestrator tests
  - Integration tests

---

## Test Coverage Comparison

### Legacy test_mad.py
```python
class TestLegacyMad:
    def test_mad_cli(self):           # Basic --help test
    def test_tags_parsing(self):      # Tag parsing
    def test_discover_mad_cli(self):  # Discover functionality
```

### Modern test_mad_cli.py
```python
class TestMadCLI:
    # Build command (300+ lines)
    def test_build_command_basic(self)
    def test_build_command_with_registry(self)
    def test_build_batch_manifest(self)
    def test_build_multi_arch(self)
    # ... 20+ build tests
    
    # Run command (400+ lines)
    def test_run_command_basic(self)
    def test_run_with_manifest(self)
    def test_run_full_workflow(self)
    # ... 25+ run tests
    
    # Discover, error handling, integration
    # ... 30+ additional tests
```

---

## Migration Path

If you're maintaining tests based on `test_mad.py`:

**Old (Deprecated):**
```python
from madengine import mad

def test_something():
    result = subprocess.run(
        [sys.executable, "mad.py", "--help"],
        capture_output=True
    )
    assert result.returncode == 0
```

**New (Recommended):**
```python
from madengine.mad_cli import app
from typer.testing import CliRunner

def test_something():
    runner = CliRunner()
    result = runner.invoke(app, ["--help"])
    assert result.exit_code == 0
```

---

## Action Required

**No immediate action required** for users of legacy `mad.py`.

**For maintainers:**
1. ✅ Verify `test_mad_cli.py` covers all scenarios from `test_mad.py`
2. ✅ Confirm all CI/CD pipelines pass with new tests
3. ⏳ Consider removing `test_mad.py` in future release after transition period

---

## Related Documentation

- New tests: `test_mad_cli.py`, `test_gpu_tool_managers.py`, `test_orchestration.py`
- Legacy CLI: `mad.py` (still supported)
- Modern CLI: `mad_cli.py` (recommended)
- GPU tools: `src/madengine/utils/README_GPU_TOOLS.md`

---

## Support

- Legacy `mad.py` continues to work for backward compatibility
- All run_models.py functionality preserved
- No breaking changes to existing workflows
- Contact: madengine maintainers for questions

