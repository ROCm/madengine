apiVersion: v1
kind: Service
metadata:
  name: {{ service_name }}
  namespace: {{ namespace }}
  labels:
    app: madengine
    model: {{ model_name }}
spec:
  clusterIP: None  # Headless service for torchrun coordination
  selector:
    job-name: {{ job_name }}
  ports:
  {% for port in ports %}
  - name: port-{{ port }}
    port: {{ port }}
    targetPort: {{ port }}
    protocol: TCP
  {% endfor %}

