{
  "_comment": "Multi-Node (4 nodes, 2 GPUs each) - Advanced Configuration",
  "_description": "Full-featured configuration for large-scale distributed workloads with PVCs, tolerations, and node affinity",
  "_use_case": "Multi-node distributed execution with advanced features on busy clusters (8 GPUs total)",
  
  "gpu_vendor": "AMD",
  "guest_os": "UBUNTU",
  
  "k8s": {
    "kubeconfig": "~/.kube/config",
    "namespace": "ml-training",
    "gpu_count": 2,
    "gpu_resource_name": "amd.com/gpu",
    
    "memory": "128Gi",
    "memory_limit": "192Gi",
    "cpu": "24",
    "cpu_limit": "32",
    
    "image_pull_policy": "IfNotPresent",
    "backoff_limit": 5,
    "host_ipc": true,
    
    "node_selector": {
      "node.kubernetes.io/instance-type": "mi300x-8gpu",
      "topology.kubernetes.io/zone": "us-west-2a",
      "workload-type": "ml-training"
    },
    
    "tolerations": [
      {
        "key": "gpu",
        "operator": "Equal",
        "value": "amd",
        "effect": "NoSchedule"
      },
      {
        "key": "workload",
        "operator": "Equal",
        "value": "training",
        "effect": "NoSchedule"
      }
    ],
    
    "results_pvc": "ml-results-pvc",
    "data_pvc": "ml-datasets-pvc",
    
    "output_dir": "./k8s_manifests/multi-node"
  },
  
  "distributed": {
    "enabled": true,
    "backend": "nccl",
    "launcher": "torchrun",
    "nnodes": 4,
    "nproc_per_node": 2,
    "master_port": 29500
  },
  
  "env_vars": {
    "NCCL_DEBUG": "WARN",
    "NCCL_DEBUG_SUBSYS": "INIT,NET,GRAPH",
    "NCCL_IB_DISABLE": "1",
    "NCCL_SOCKET_IFNAME": "eth0",
    "TORCH_NCCL_HIGH_PRIORITY": "1",
    "GPU_MAX_HW_QUEUES": "2",
    "TORCH_NCCL_ASYNC_ERROR_HANDLING": "1",
    "NCCL_TIMEOUT": "600",
    "HSA_ENABLE_SDMA": "0",
    "HSA_FORCE_FINE_GRAIN_PCIE": "1",
    "OMP_NUM_THREADS": "8",
    "MIOPEN_FIND_MODE": "1",
    "MIOPEN_USER_DB_PATH": "/tmp/.miopen",
    "RCCL_ENABLE_HIPGRAPH": "0"
  },
  
  "_env_var_notes": {
    "NCCL_DEBUG": "Changed to WARN for cleaner logs (use INFO for debugging)",
    "MIOPEN_FIND_MODE": "1 = Use compiled kernels, avoid find-db warnings",
    "MIOPEN_USER_DB_PATH": "Writable location for MIOpen cache",
    "HSA_FORCE_FINE_GRAIN_PCIE": "Helps with IOMMU-related warnings",
    "RCCL_ENABLE_HIPGRAPH": "Disable for compatibility",
    "NCCL_MIN_NCHANNELS": "Removed (warning says ignored for <8 GPUs)"
  },
  
  "debug": false
}
